{% extends "base.html" %}
{% block content %}

<h2>Edit Recipe</h2>

<div class="row card-panel grey lighten-5">
  <form class="col s12" method="POST" action="{{ url_for('edit_recipe', recipe_id=recipe.recipe_id) }}" enctype="multipart/form-data">

    <div class="row">
      <div class="input-field col s12">
        <!-- Recipe Name field -->
        <input id="recipe_name" name="recipe_name" minlength="5" maxlength="55" type="text" class="validate" value="{{ recipe.recipe_name }}" required>
        <label for="recipe_name">Recipe Name (required)</label>
      </div>
    </div>

    <div class="row">
      <div class="input-field col s12">
        <!-- Recipe Description field -->
        <textarea id="recipe_desc" name="recipe_desc" class="materialize-textarea" required>{{ recipe.recipe_desc }}</textarea>
        <label for="recipe_desc">Recipe Description (required)</label>
      </div>
    </div>

    <!-- Tags field -->
    <div class="row">
      <div class="col s6">
        <p>Searchable Tags</p>
        <p>(Optional, press enter for each tag)</p>
      </div>
      <div class="col s6">
        <div class="chips chips-autocomplete">
          {% if recipe.tags %}
            {% for tag in recipe.tags %}
              {% if tag.recipe_tag %}
                <div class="chip">
                  {{ tag.recipe_tag.tag_name }}
                  <i class="material-icons clear"></i>
                </div>
              {% endif %}
            {% endfor %}
          {% endif %}
        </div>
        <input type="hidden" name="tags" id="tags_input">
      </div>
    </div>

    <!-- Stages for Instructions -->
    <div class="row">
      {% for stage in recipe.stages %}
        <div class="input-field col s12">
          <textarea id="instructions_{{ stage.stage_num }}" name="instructions[]" class="materialize-textarea" required>{{ stage.instructions }}</textarea>
          <label for="instructions_{{ stage.stage_num }}">Stage {{ stage.stage_num }} Instructions (required)</label>
        </div>
       <div>
         <img src="{{ stage.recipe_images[0].thumbnail_url }}" alt="{{ stage.recipe_images[0].alt_text }}">
        </div>
        <!-- edit image field should this only display when previewed image is hidden? -->
        <div class="file-field input-field">
          <div class="btn">
            <span>Edit Image</span>
            <input type="file" name="images[]" accept="image/*">
          </div>
          <div class="file-path-wrapper">
            <input class="file-path validate" type="text" placeholder="Add an optional image for stage {{ stage.stage_num }}" value="{{ stage.recipe_images[0].thumbnail_url }}">
           
            <!-- edit alt text field -->
            <div class="input-field">
              <textarea id="image_desc_1" name="image_desc[]" class="materialize-textarea">{{ stage.recipe_images[0].alt_text }}</textarea>
              <label for="image_desc_1">Image Description</label>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Buttons to handle adding/deleting rows -->
    <div class="row">
      <div class="col s12 center-align">
        <button type="button" class="add_edit_field">Add Stage</button>
        <button type="button" class="remove_edit_field">Remove Stage</button>
      </div>
    </div>

    <!-- Button to submit the recipe -->
    <div class="row">
      <div class="col s12 center-align">
        <button type="submit" class="btn-small light-blue darken-1">Save Edited Recipe</button>
      </div>
    </div>

  </form>
</div>

{% endblock %}
